{% extends 'base.html' %}
{% block title %}Placement Training{% endblock %}
{% block page %}Placement Training{% endblock %}
{% block Main_title %}Placement Training{% endblock %}

{% block content %}
<div class="container my-5">

    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="fw-bold text-primary">
            <i class="bi bi-mortarboard"></i> Placement Trainings
        </h3>
        <!-- Button to trigger modal -->
        <button class="btn btn-success shadow-sm" data-bs-toggle="modal" data-bs-target="#uploadTrainingModal">
            <i class="bi bi-cloud-upload"></i> Upload Training
        </button>
    </div>

    <!-- Upload Training Modal -->
    <div class="modal fade" id="uploadTrainingModal" tabindex="-1" aria-labelledby="uploadTrainingLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg rounded-3">
          <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="modal-header bg-success text-white">
              <h5 class="modal-title fw-bold" id="uploadTrainingLabel">
                <i class="bi bi-plus-circle"></i> New Training Upload
              </h5>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            
            <div class="modal-body px-4">
                <div class="mb-3">
                    <label for="title" class="form-label fw-semibold">Title</label>
                    <input type="text" name="title" id="title" class="form-control" placeholder="Enter training title" required>
                </div>
                
                <div class="mb-3">
                    <label for="description" class="form-label fw-semibold">Description</label>
                    <textarea name="description" id="description" class="form-control" rows="3" placeholder="Write a short description..."></textarea>
                </div>

                <hr>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="training_type" class="form-label fw-semibold">Training Type</label>
                        <select name="training_type" id="training_type" class="form-select" required>
                            <option value="">-- Select Type --</option>
                            <option value="video">ðŸŽ¥ Video</option>
                            <option value="quiz">ðŸ“„ Quiz (PDF)</option>
                        </select>
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <label for="file" class="form-label fw-semibold">Upload File</label>
                        <input type="file" name="file" id="file" class="form-control" required>
                        <div class="form-text">Upload an MP4 video or PDF quiz.</div>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer border-0">
              <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                  <i class="bi bi-x-circle"></i> Cancel
              </button>
              <button type="submit" class="btn btn-success">
                  <i class="bi bi-cloud-arrow-up"></i> Upload
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Manage Trainings Section -->
    <h4 class="mt-5 mb-3 text-secondary fw-semibold">Manage Trainings</h4>
    <div class="row g-4">
        {% for training in trainings %}
            <div class="col-md-6 col-lg-4">
                <div class="card border-0 shadow-sm h-100 training-card">
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title fw-bold text-dark">
                            <i class="bi bi-journal-text text-primary"></i> {{ training.title }}
                        </h5>
                        <p class="card-text text-muted small">{{ training.description|truncatechars:120 }}</p>
                        
                        <span class="badge 
                            {% if training.vedio %} bg-primary 
                            {% elif training.quize %} bg-warning text-dark 
                            {% endif %} 
                            align-self-start mb-3 px-3 py-2 rounded-pill shadow-sm">
                            {% if training.vedio %} ðŸŽ¥ Video {% elif training.quize %} ðŸ“„ Quiz {% endif %}
                        </span>
                        
                        <div class="mt-auto">
                            {% if training.vedio %}
                                <div class="ratio ratio-16x9 mb-3">
                                    <video controls class="rounded shadow-sm">
                                        <source src="{{ training.vedio.url }}" type="video/mp4">
                                        Your browser does not support video.
                                    </video>
                                </div>
                            {% elif training.quize %}
                                <div class="d-grid gap-2">
                                    <a href="{{ training.quize.url }}" target="_blank" class="btn btn-outline-primary">
                                        <i class="bi bi-eye"></i> View Quiz
                                    </a>
                                    <a href="{{ training.quize.url }}" class="btn btn-primary" download>
                                        <i class="bi bi-download"></i> Download Quiz
                                    </a>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="card-footer bg-light border-0 d-flex justify-content-end gap-2">
                        
                        <form method="post" action="{% url 'teacher:delete_training' training.id %}" style="display:inline;">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-sm btn-outline-danger" 
                                    onclick="return confirm('Are you sure you want to delete {{ training.title }}?');"
                                    data-bs-toggle="tooltip" title="Delete Training">
                                <i class="bi bi-trash"></i>
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        {% empty %}
            <div class="col-12">
                <div class="alert alert-info text-center shadow-sm">
                    <i class="bi bi-info-circle"></i> No trainings uploaded yet.
                </div>
            </div>
        {% endfor %}
    </div>
</div>

<!-- Tooltip init -->
<script>
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    tooltipTriggerList.map(function (tooltipTriggerEl) {
      return new bootstrap.Tooltip(tooltipTriggerEl)
    })
</script>
{% endblock %}
