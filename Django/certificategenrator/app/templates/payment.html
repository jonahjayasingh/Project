{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<link rel="shortcut icon" href="{% static 'icon.png' %}" type="image/x-icon">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Payment Stats</title>
    <link rel="stylesheet" href="{% static 'css/flatpickr.min.css' %}">
    <script src="{% static 'js/browser@4.js' %}"></script>
    <style>
      .gradient-text {
        background: linear-gradient(135deg, #ec4899, #8b5cf6, #3b82f6);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        font-weight: 700;
      }

      .bg-gradient-header {
        background: linear-gradient(135deg, #ec4899 0%, #8b5cf6 50%, #3b82f6 100%);
      }

      @keyframes fadeIn {
          from { opacity: 0; transform: translateY(20px); }
          to { opacity: 1; transform: translateY(0); }
      }
      
      @keyframes pulse {
          0%, 100% { transform: scale(1); }
          50% { transform: scale(1.05); }
      }
      
      @keyframes shimmer {
          0% { background-position: -200px 0; }
          100% { background-position: calc(200px + 100%) 0; }
      }
      
      .animate-fade-in { animation: fadeIn 0.6s ease-out; }
      .animate-pulse-slow { animation: pulse 2s infinite; }
      .animate-shimmer {
          background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
          background-size: 200px 100%;
          animation: shimmer 2s infinite;
      }
      
      .gradient-text {
          background: linear-gradient(135deg, #ec4899, #8b5cf6, #3b82f6);
          -webkit-background-clip: text;
          background-clip: text;
          color: transparent;
          font-weight: 700;
      }
      
      .stat-card {
          backdrop-filter: blur(10px);
          border: 1px solid rgba(255, 255, 255, 0.2);
          transition: all 0.3s ease;
      }
      
      .stat-card:hover {
          transform: translateY(-5px);
          box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
          border-color: rgba(255, 255, 255, 0.3);
      }
      
      .icon-container {
          transition: all 0.3s ease;
      }
      
      .stat-card:hover .icon-container {
          transform: rotate(10deg) scale(1.1);
      }
      
      .number-counter {
          font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
      }

      /* Modal styles */
      .modal {
          transition: opacity 0.3s ease, visibility 0.3s ease;
      }
      
      .modal-content {
          transform: translateY(-20px);
          transition: transform 0.3s ease;
      }
      
      .modal.active {
          opacity: 1;
          visibility: visible;
      }
      
      .modal.active .modal-content {
          transform: translateY(0);
      }

      /* Table styles */
      .payment-table {
          width: 100%;
          border-collapse: separate;
          border-spacing: 0;
          margin-top: 2rem;
      }
      
      .payment-table thead th {
          background: linear-gradient(135deg, #ec4899 0%, #8b5cf6 50%, #3b82f6 100%);
          color: white;
          padding: 1rem;
          text-align: left;
          position: sticky;
          top: 0;
      }
      
      .payment-table tbody tr:nth-child(even) {
          background-color: rgba(236, 72, 153, 0.05);
      }
      
      .payment-table tbody tr:hover {
          background-color: rgba(236, 72, 153, 0.1);
      }
      
      .payment-table td {
          padding: 1rem;
          border-bottom: 1px solid #e5e7eb;
      }
      
      .amount-paid {
          color: #10b981;
          font-weight: 600;
      }
      
      .amount-pending {
          color: #f59e0b;
          font-weight: 600;
      }
    </style>
</head>
<body class="bg-gradient-to-br from-pink-50 via-purple-50 to-blue-50 min-h-screen">
  <nav class="bg-gradient-header shadow-lg mb-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between h-16 items-center">
        <div class="flex items-center space-x-2">
          <a href="{% url 'app:dashboard' %}" class="text-white font-extrabold text-xl mobile-text-sm">Admin Dashboard</a>
        </div>
       <a href="{% url 'app:logout' %}" 
           class="glass-effect hover:bg-white/30 text-white font-semibold py-2 px-4 rounded-full shadow-lg transition-all duration-300 backdrop-blur-sm text-sm sm:text-base btn-bounce">
          <span class="hidden sm:inline">Logout</span>
          <span class="sm:hidden">
              <img src="{% static 'power-off-svgrepo-com.svg' %}" alt="" style="width: 20px; height: 20px;">


          </span>
        </a>
      </div>
    </div>
  </nav>
  <div class="fixed sm:absolute top-20 left-4 sm:top-30 sm:left-6 z-30">
      <a href="{% url 'app:dashboard' %}" class="flex items-center space-x-2 sm:space-x-3 bg-white/80 backdrop-blur-sm hover:bg-white text-gray-700 hover:text-gray-900 font-medium py-2 px-4 sm:py-3 sm:px-6 rounded-xl sm:rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 transform hover:-translate-y-0.5 sm:hover:-translate-y-1 group">
        <div class="w-6 h-6 sm:w-8 sm:h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center transition-all duration-200 group-hover:scale-110">
          <svg class="w-3 h-3 sm:w-4 sm:h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
          </svg>
        </div>
        <span class="text-sm sm:text-base font-semibold">Back</span>
      </a>
    </div>
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Header -->
        <div class="text-center mb-12 animate-fade-in">
            <h1 class="gradient-text text-5xl font-bold mb-4">Payment Dashboard</h1>
        </div>
        
        <!-- Stats Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-12">
            <!-- Total Students -->
            <div class="stat-card bg-white/70 rounded-3xl p-8 animate-fade-in" style="animation-delay: 0.1s">
                <div class="flex items-center justify-between mb-4">
                    <div class="icon-container p-4 bg-gradient-to-r from-orange-400 to-pink-500 rounded-2xl shadow-lg">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"/>
                        </svg>
                    </div>
                    <div class="text-right">
                        <div class="w-12 h-2 bg-gradient-to-r from-orange-200 to-pink-200 rounded-full overflow-hidden">
                            <div class="h-full bg-gradient-to-r from-orange-400 to-pink-500 rounded-full animate-shimmer"></div>
                        </div>
                    </div>
                </div>
                <div>
                    <p class="text-sm font-medium text-gray-500 uppercase tracking-wide mb-2">Newly Registration</p>
                    <p class="text-4xl font-bold number-counter gradient-text animate-pulse-slow">{{students | length}}</p>
                </div>
            </div>
            
            <!-- Total Amount -->
            <div class="stat-card bg-white/70 rounded-3xl p-8 animate-fade-in" style="animation-delay: 0.2s">
                <div class="flex items-center justify-between mb-4">
                    <div class="icon-container p-4 bg-gradient-to-r from-green-400 to-blue-500 rounded-2xl shadow-lg">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"/>
                        </svg>
                    </div>
                    <div class="text-right">
                        <div class="w-12 h-2 bg-gradient-to-r from-green-200 to-blue-200 rounded-full overflow-hidden">
                            <div class="h-full bg-gradient-to-r from-green-400 to-blue-500 rounded-full animate-shimmer"></div>
                        </div>
                    </div>
                </div>
                <div>
                    <p class="text-sm font-medium text-gray-500 uppercase tracking-wide mb-2">Total Collection</p>
                    <p class="text-4xl font-bold number-counter gradient-text animate-pulse-slow">â‚¹{{total_fee}}</p>
                </div>
            </div>
            
            <!-- Collected Amount -->
            <div class="stat-card bg-white/70 rounded-3xl p-8 animate-fade-in" style="animation-delay: 0.3s">
                <div class="flex items-center justify-between mb-4">
                    <div class="icon-container p-4 bg-gradient-to-r from-purple-400 to-pink-500 rounded-2xl shadow-lg">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </div>
                    <div class="text-right">
                        <div class="w-12 h-2 bg-gradient-to-r from-purple-200 to-pink-200 rounded-full overflow-hidden">
                            <div class="h-full bg-gradient-to-r from-purple-400 to-pink-500 rounded-full animate-shimmer"></div>
                        </div>
                    </div>
                </div>
                <div>
                    <p class="text-sm font-medium text-gray-500 uppercase tracking-wide mb-2">Collected Amount</p>
                    <p class="text-4xl font-bold number-counter gradient-text animate-pulse-slow">â‚¹{{total_amount}}</p>
                </div>
            </div>
            
            <!-- Pending Amount -->
            <div class="stat-card bg-white/70 rounded-3xl p-8 animate-fade-in" style="animation-delay: 0.4s">
                <div class="flex items-center justify-between mb-4">
                    <div class="icon-container p-4 bg-gradient-to-r from-blue-400 to-indigo-500 rounded-2xl shadow-lg">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </div>
                    <div class="text-right">
                        <div class="w-12 h-2 bg-gradient-to-r from-blue-200 to-indigo-200 rounded-full overflow-hidden">
                            <div class="h-full bg-gradient-to-r from-blue-400 to-indigo-500 rounded-full animate-shimmer"></div>
                        </div>
                    </div>
                </div>
                <div>
                    <p class="text-sm font-medium text-gray-500 uppercase tracking-wide mb-2">Pending Collection </p>
                    <p class="text-4xl font-bold number-counter gradient-text animate-pulse-slow">â‚¹{{pending_amount}}</p>
                </div>
            </div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-8">
            <!-- View Reports Button - Triggers Modal -->
            <button onclick="openModal()" class="bg-gradient-to-r from-blue-500 to-indigo-600 text-white font-bold py-4 px-6 rounded-2xl shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                <div class="flex items-center justify-center space-x-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                    </svg>
                    <span>View Payments</span>
                </div>
            </button>
            
            <form action="{% url 'app:payment_excel' %}" method="post" class="bg-gradient-to-r from-green-500 to-teal-600 text-white font-bold py-4 px-6 rounded-2xl shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 flex items-center justify-center space-x-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>    
                {% csrf_token %}
                    <input type="hidden" name="date" value="{{ date }}">

                    <button type="submit" >
                        
                        <span>Export Data</span>
                    </button>
                </form>

        </div>

        {% if show_table %}
        {%if students%}
        <div class="bg-white rounded-2xl shadow-lg overflow-hidden mt-8 animate-fade-in">
            <div class="overflow-x-auto">
                <table class="payment-table w-full">
                    <thead>
                        <tr>
                            <th class="rounded-tl-2xl">Name</th>
                            <th>Phone Number</th>
                            <th>Total Amount</th>
                            <th class="rounded-tr-2xl">Amount Paid</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for student in students %}
                        <tr>
                            <td>{{student.name}}</td>
                            <td>{{student.phone}}</td>
                            <td>â‚¹{{student.total_fee}}</td>
                            <td class="{% if student.total_paid == student.total_fee %}amount-paid{% else %}amount-pending{% endif %}">
                                â‚¹{{ student.total_paid|default:0 }}
                                {% if student.total_paid != student.total_fee %}
                                <span class="text-xs text-gray-500 block">(Pending: â‚¹ {% if student.pending %} {{ student.pending| default:0 }}{% else %} {{student.total_fee}} {% endif %})</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% else  %}
        <div class=" h-[10vh] bg-white rounded-2xl shadow-lg overflow-hidden mt-8 animate-fade-in flex  justify-center items-center">
            <h3>No Studenty data found in this range </h3>
        </div>
        {% endif %}
        {% endif %}

    </div>

    <!-- Reports Modal -->
    <div id="reportsModal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 opacity-0 invisible">
        <div class="modal-content bg-white rounded-2xl w-full max-w-md mx-4 overflow-hidden">
            <div class="bg-gradient-to-r from-blue-500 to-indigo-600 p-6 text-white">
                <h3 class="text-xl font-bold">Get Payment Details</h3>
                <p class="text-sm opacity-80">Select date range for the report</p>
            </div>
            
            <div class="p-6">
                <form id="reportForm" method="post" >    
                    {% csrf_token %}                
                    <div class="mb-4" id="dateRangeContainer">
                        <label for="dateRange" class="block text-sm font-medium text-gray-700 mb-2">Date Range</label>
                        <input type="text" id="dateRange" name="dateRange" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Select date range" required>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <button type="button" onclick="closeModal()" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg transition duration-300">
                            Cancel
                        </button>
                        <button type="submit" class="bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300">
                            GET
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="{% static 'js/flatpickr.js' %}"></script>
    <script>
        // Modal functions
        function openModal() {
            document.getElementById('reportsModal').classList.add('active');
        }
        
        function closeModal() {
            document.getElementById('reportsModal').classList.remove('active');
        }
        
        // Close modal when clicking outside
        document.getElementById('reportsModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
        
        // Initialize date range picker
        flatpickr("#dateRange", {
            mode: "range",
            dateFormat: "Y-m-d",
            defaultDate: [new Date(), new Date()],
            maxDate: "today"
        });

        // Form submission handling
        document.getElementById('reportForm').addEventListener('submit', function(e) {
            // You can add additional validation here if needed
            const dateRange = document.getElementById('dateRange').value;
            if (!dateRange) {
                e.preventDefault();
                alert('Please select a date range');
                return false;
            }
            return true;
        });
    </script>
</body>
</html>