{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="shortcut icon" href="{% static 'icon.png' %}" type="image/x-icon">
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Student Details</title>
    <link href="{% static 'css/flowbite.min.css' %}" rel="stylesheet" />
    <link rel="stylesheet" href="{% static 'css/tailwind.css' %}" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
    <link rel="stylesheet" href="{% static 'css/flatpickr.min.css' %}" />
    <style>
      .gradient-text {
        background: linear-gradient(135deg, #ec4899, #a855f7, #3b82f6);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        font-weight: 700;
        animation: gradientMove 6s ease infinite;
        background-size: 200% 200%;
      }

      @keyframes gradientMove {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      .bg-gradient-header {
        background: linear-gradient(135deg, #ec4899 0%, #a855f7 50%, #3b82f6 100%);
      }

      .bg-gradient-button {
        background: linear-gradient(135deg, #ec4899 0%, #a855f7 50%, #3b82f6 100%);
      }

      .card-shadow {
        box-shadow: 0 10px 30px rgba(236, 72, 153, 0.1);
      }

      body {
        background: linear-gradient(to bottom right, #fdf2f8, #ede9fe);
      }

      .input-field {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid #e5e7eb;
        border-radius: 0.5rem;
        outline: none;
        transition: border 0.3s ease;
        font-size: 0.875rem;
      }

      .input-field:focus {
        border-color: #ec4899;
        box-shadow: 0 0 0 3px rgba(236, 72, 153, 0.1);
      }

      .modal-backdrop {
        background-color: rgba(0, 0, 0, 0.5);
      }

      label {
        display: block;
        font-size: 0.875rem;
        font-weight: 600;
        color: #374151;
        margin-bottom: 0.5rem;
      }
    </style>
  </head>

  <body class="min-h-screen">
    <!-- Navigation -->
    <nav class="bg-gradient-header shadow-lg">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between h-16 items-center">
          <a href="#" class="text-white font-extrabold text-xl">Staff Dashboard</a>
          <a href="{% url 'app:logout' %}"
            class="glass-effect hover:bg-white/30 text-white font-semibold py-2 px-4 rounded-full shadow-lg transition-all duration-300 backdrop-blur-sm text-sm sm:text-base btn-bounce">
            <span class="hidden sm:inline">Logout</span>
            <span class="sm:hidden">
              <img src="{% static 'power-off-svgrepo-com.svg' %}" alt="" style="width: 20px; height: 20px;">
            </span>
          </a>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-4xl mx-auto px-4 py-12">
      {% if student %}
      <div class="bg-white p-8 rounded-2xl shadow-lg card-shadow text-center">
        <h1 class="gradient-text text-3xl mb-6">Student Details</h1>

        <!-- Option 1: Profile Card Style -->
        <div class="bg-gradient-to-r from-pink-100 via-purple-100 to-blue-100 p-6 rounded-2xl mb-6">
          <div class="flex flex-col md:flex-row items-start md:items-center gap-6">
            <!-- Avatar/Initial -->
            <div class="w-24 h-24 bg-gradient-header rounded-full flex items-center justify-center text-white text-3xl font-bold shadow-lg">
              {{ student.name|first|upper }}
            </div>

            <!-- Main Info -->
            <div class="flex-1">
              <h2 class="text-2xl font-bold text-gray-800 mb-2">{{ student.name }}</h2>
              <div class="flex flex-wrap gap-4 mb-3">
                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-pink-200 text-pink-800">
                  <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path>
                    <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path>
                  </svg>
                  {{ student.email }}
                </span>
                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-purple-200 text-purple-800">
                  <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"></path>
                  </svg>
                  {{ student.phone }}
                </span>
                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-200 text-blue-800">
                  Reg: {{ student.registration_no }}
                </span>
              </div>

              <!-- Course Highlight -->
              <div class="bg-white/50 backdrop-blur-sm p-4 rounded-xl">
                <div class="flex items-center justify-between">
                  <div>
                    <h3 class="font-bold text-lg text-gray-800">{{ student.course_name }}</h3>
                    <p class="text-gray-600">{{ student.duration }} ‚Ä¢ Faculty: {{ student.faculty_name }}</p>
                  </div>
                  <div class="text-right">
                    <p class="text-2xl font-bold gradient-text">‚Çπ{{ student.total_fee }}</p>
                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium {% if student.online %}bg-green-100 text-green-800{% else %}bg-blue-100 text-blue-800{% endif %}">
                      {% if student.online %}üåê Online{% else %}üè¢ Offline{% endif %}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Option 2: Details Table -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <!-- Left Column -->
          <div class="space-y-4">
            <div class="bg-white border-l-4 border-pink-400 p-4 rounded-r-xl shadow-sm">
              <h4 class="font-semibold text-pink-700 mb-3">üìã Personal Information</h4>
              <div class="space-y-2 text-sm">
                <div class="grid grid-cols-3 gap-2">
                  <span class="text-gray-500">Name:</span>
                  <span class="col-span-2 font-medium">{{ student.name }}</span>
                </div>
                <div class="grid grid-cols-3 gap-2">
                  <span class="text-gray-500">Phone:</span>
                  <span class="col-span-2 font-medium">{{ student.phone }}</span>
                </div>
                <div class="grid grid-cols-3 gap-2">
                  <span class="text-gray-500">Email:</span>
                  <span class="col-span-2 font-medium text-xs">{{ student.email }}</span>
                </div>
                <div class="grid grid-cols-3 gap-2">
                  <span class="text-gray-500">Qualification:</span>
                  <span class="col-span-2 font-medium">{{ student.qualification }}</span>
                </div>
                <div class="grid grid-cols-3 gap-2">
                  <span class="text-gray-500">Date of Birth:</span>
                  <span class="col-span-2 font-medium">{{ student.dob }}</span>
                </div>
                <div class="grid grid-cols-3 gap-2">
                  <span class="text-gray-500">Marital Status:</span>
                  <span class="col-span-2 font-medium">{% if student.marital_status %}{{ student.marital_status }}{% else %}Not specified{% endif %}</span>
                </div>
              </div>
            </div>

            <div class="bg-white border-l-4 border-blue-400 p-4 rounded-r-xl shadow-sm">
              <h4 class="font-semibold text-blue-700 mb-3">üìç Address Details</h4>
              <div class="space-y-2 text-sm">
                <div class="grid grid-cols-3 gap-2">
                  <span class="text-gray-500">Address:</span>
                  <span class="col-span-2 font-medium">{{ student.address }}</span>
                </div>
                <div class="grid grid-cols-3 gap-2">
                  <span class="text-gray-500">Pincode:</span>
                  <span class="col-span-2 font-medium">{{ student.pincode }}</span>
                </div>
                <div class="grid grid-cols-3 gap-2">
                  <span class="text-gray-500">Registration Date:</span>
                  <span class="col-span-2 font-medium">{{ student.date }}</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Right Column -->
          <div class="bg-white border-l-4 border-purple-400 p-4 rounded-r-xl shadow-sm h-fit">
            <h4 class="font-semibold text-purple-700 mb-3">üéì Course Information</h4>
            <div class="space-y-4">
              <div class="bg-gradient-to-r from-purple-50 to-pink-50 p-4 rounded-xl">
                <h5 class="font-bold text-lg text-gray-800 mb-2">{{ student.course_name }}</h5>
                <div class="grid grid-cols-2 gap-4 text-sm">
                  <div>
                    <span class="text-gray-500 block">Duration</span>
                    <span class="font-semibold">{{ student.duration }}</span>
                  </div>
                  <div>
                    <span class="text-gray-500 block">Total Fee</span>
                    <span class="font-bold text-lg gradient-text">‚Çπ{{ student.total_fee }}</span>
                  </div>
                  <div>
                    <span class="text-gray-500 block">Joined Date</span>
                    <span class="font-semibold">{{ student.joined_date }}</span>
                  </div>
                  <div>
                    <span class="text-gray-500 block">Faculty</span>
                    <span class="font-medium">{{ student.faculty_name }}</span>
                  </div>
                  <div>
                    <span class="text-gray-500 block">Mode</span>
                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium {% if student.online %}bg-green-100 text-green-800{% else %}bg-blue-100 text-blue-800{% endif %}">
                      {% if student.online %}üåê Online{% else %}üè¢ Offline{% endif %}
                    </span>
                  </div>
                </div>
              </div>

              <!-- Registration Badge -->
              <div class="text-center p-4 bg-gradient-header rounded-xl text-white">
                <div class="text-sm opacity-90">Registration Number</div>
                <div class="text-xl font-bold">{{ student.registration_no }}</div>
              </div>
            </div>
          </div>
        </div>

        {% if messages %}
            {% for message in messages %}
                <div class="message p-3 rounded-lg text-sm text-center border
                    {% if 'error' in message.tags %}
                        text-pink-600 bg-pink-50 border-pink-100
                    {% elif 'success' in message.tags %}
                        text-green-600 bg-green-50 border-green-100
                    {% elif 'warning' in message.tags %}
                        text-yellow-700 bg-yellow-50 border-yellow-200
                    {% else %}
                        text-blue-600 bg-blue-50 border-blue-100
                    {% endif %}
                ">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}

        <div class="mt-10 flex flex-wrap gap-4 justify-center">
           <div class="mt-10 flex flex-wrap gap-4 justify-center">
          <a href="{% url 'staff:add_student' %}"
          class="bg-pink-600 hover:bg-pink-700 text-pink-50 font-semibold py-2 px-5 rounded-xl shadow-md transition-all duration-300 cursor-pointer">Back</a>
          {% if permission.certificate_permission %}
          <button
            {% if student.total_fee == payment.paid_ammount %}
              {% else %}
              disabled
              {% endif %}
            data-modal-target="generateModal"
            data-modal-toggle="generateModal"
            {% if student.total_fee == payment.paid_ammount %}
            {% else %}
            disabled
            {% endif %}
            class="bg-pink-600 hover:bg-pink-700 text-pink-50 font-semibold py-2 px-5 rounded-xl shadow-md transition-all duration-300 cursor-pointer"
          >Generate Certificate</button>
          {% endif %}
          {% if permission.student_permission %}
          <button
            data-modal-target="editStudentModal"
            data-modal-toggle="editStudentModal"
            class="bg-fuchsia-600 hover:bg-fuchsia-700 text-pink-50 font-semibold py-2 px-5 rounded-xl shadow-md transition-all duration-300 cursor-pointer"
          >Edit Student</button>

          <a
            href="{% url 'app:delete_student' student.id %}"
            onclick="return confirm('Are you sure you want to delete this student?')"
            class="bg-purple-700 hover:bg-purple-800 text-pink-50 font-semibold py-2 px-5 rounded-xl shadow-md transition-all duration-300"
          >Delete</a>
          {% endif %}`
          {% if permission.receipt_permission %}
          {% if payment.paid_ammount != student.total_fee %}
          <button
            data-modal-target="generateReceiptModal"
            data-modal-toggle="generateReceiptModal"
            class="bg-pink-600 hover:bg-pink-700 text-pink-50 font-semibold py-2 px-5 rounded-xl shadow-md transition-all duration-300 cursor-pointer"
          >PAY</button>
          {% else %}
          <span class="bg-green-500 text-white font-semibold py-2 px-5 rounded-xl shadow-md transition-all duration-300 cursor-not-allowed">Payment completed</span>
          {% endif %}
          {% endif %}







        </div>
        </div>
      </div>
      {% else %}
      <div class="bg-white p-8 rounded-xl shadow-md text-center">
        <h2 class="text-xl font-bold text-red-500">Student Not Found</h2>
        <p class="text-gray-600 mt-2">The student you are looking for does not exist.</p>
        <a
          href="{% url 'staff:staff_dashboard' %}"
          class="inline-block mt-4 bg-rose-500 hover:bg-rose-600 text-white font-semibold py-2 px-5 rounded-xl shadow-md transition-all duration-300"
        >Back to Dashboard</a>
      </div>
      {% endif %}
    </main>

    <!-- Generate Certificate Modal -->
    <div id="generateModal" tabindex="-1" aria-hidden="true" class="fixed top-0 left-0 right-0 z-50 hidden w-full p-4 overflow-x-hidden overflow-y-auto h-[calc(100%-1rem)] max-h-full modal-backdrop">
      <div class="relative w-full max-w-md max-h-full mx-auto mt-20">
        <div class="relative bg-white rounded-lg shadow-xl">
          <div class="flex items-center justify-between p-4 border-b rounded-t">
            <h3 class="text-lg font-semibold text-gray-800">Generate Certificate</h3>
            <button type="button" class="text-gray-400 hover:text-gray-900 hover:bg-gray-100 rounded-full p-2 transition-colors" data-modal-hide="generateModal">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
              </svg>
            </button>
          </div>
          <form method="post" id="GCForm"  action="{% url 'app:generate_certificate' %}" class="p-6 space-y-4">
            {% csrf_token %}
            <input type="hidden" name="student_id" value="{{ student.id }}">
            <input type="hidden" name="redirect" value="ss">
            <!-- Certificate Type Dropdown -->
            <div class="mb-4">
              <label for="certificate_type" class="block text-sm font-medium text-gray-700 mb-2">Certificate Type</label>
              <select id="certificate_type" name="certificate_type"
                      class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                <option value="">Select Type</option>
                <option value="a4">A4 Certificate</option>
                <option value="Course">Course</option>
              </select>
            </div>

            <!-- Project Title Wrapper -->
            <div id="project_title_wrapper" class="hidden mb-4">
              <label for="project_title" class="block text-sm font-medium text-gray-700 mb-2">Project Title</label>
              <input type="text" id="project_title" name="project_title"
                     class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                     placeholder="Enter project title">
            </div>

            <!-- Date Range Wrapper -->
            <div class="hidden mb-4" id="date_wrapper">
              <label for="dateRange" class="block text-sm font-medium text-gray-700 mb-2">Date Range</label>
              <input type="text" id="dateRange" name="dateRange"
                     class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 date-range-input"
                     placeholder="Select date range" required>
            </div>

            <div>
              <label for="completed_date" class="block text-sm font-medium text-gray-700 mb-1">
                Certificate Issued Date
              </label>
              <input type="date" id="completed_date" name="completed_date" required
                class="block w-full rounded-md border-gray-300 shadow-sm focus:border-pink-500 focus:ring-pink-500 sm:text-sm" />
            </div>

            <button type="submit" onclick="GCBlock()" id="GC_btn"
              class="w-full bg-pink-600 hover:bg-pink-700 text-white font-semibold py-2 rounded-lg transition duration-300">
              Generate Certificate
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- Edit Student Modal -->
    <div
      id="editStudentModal"
      tabindex="-1"
      aria-hidden="true"
      class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full inset-0 h-modal h-full modal-backdrop"
    >
      <div class="relative p-4 w-full max-w-4xl">
        <div class="relative bg-white rounded-2xl shadow-2xl">
          <!-- Header -->
          <div class="flex justify-between items-center p-6 border-b border-gray-200 rounded-t-2xl">
            <h3 class="text-2xl font-bold gradient-text">Edit Student</h3>
            <button
              data-modal-hide="editStudentModal"
              class="text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full p-2 transition-colors"
            >
              <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
              </svg>
            </button>
          </div>

          <!-- Body -->
          <div class="p-6 max-h-[70vh] overflow-y-auto">
            <form method="post" action="{% url 'app:edit_student' %}" id="editStudentForm" class="space-y-6">
              {% csrf_token %}
              <input type="hidden" name="student_id" value="{{ student.id }}">
                <input type="hidden" name="redirect" value="ss">
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div>
                  <label for="editStudentName">Student Name</label>
                  <input
                    type="text"
                    name="name"
                    id="editStudentName"
                    placeholder="Enter full name"
                    required
                    class="input-field"
                    value="{{ student.name }}"
                  />
                </div>

                <div>
                  <label for="editStudentPhone">Phone Number</label>
                  <input
                    type="tel"
                    name="phone"
                    id="editStudentPhone"
                    placeholder="Enter phone number"
                    required
                    class="input-field"
                    value="{{ student.phone }}"
                  />
                </div>

                <div>
                  <label for="editStudentEmail">Email Address</label>
                  <input
                    type="email"
                    name="email"
                    id="editStudentEmail"
                    placeholder="Enter email address"
                    required
                    class="input-field"
                    value="{{ student.email }}"
                  />
                </div>
                <div>
                  <label for="editStudentDob">Date of Birth</label>
                  <input
                    type="date"
                    name="dob"
                    id="editStudentDob"
                    required
                    class="input-field"
                    value="{{ student.dob|date:'Y-m-d' }}"
                  />
                </div>

                <div>
                  <label for="editStudentCourseName">Course Name</label>
                  <select name="course_name" id="editStudentCourseName" required class="input-field">
                    <option value="">Select Course</option>
                    {% for course in courses %}
                    <option value="{{course.course_name}}" {% if student.course_name == course.course_name %}selected{% endif %}>{{course.course_name}}</option>
                    {% endfor %}
                  </select>
                </div>

                <div>
                  <label for="editStudentDuration">Course Duration</label>
                  <input
                    type="text"
                    name="duration"
                    id="editStudentDuration"
                    placeholder="e.g., 6 months"
                    required
                    class="input-field"
                    value="{{ student.duration }}"
                  />
                </div>

                <div>
                  <label for="editStudentTotalFee">Total Fee</label>
                  <input
                    type="number"
                    name="total_fee"
                    id="editStudentTotalFee"
                    placeholder="Enter total fee"
                    required
                    class="input-field"
                    value="{{ student.total_fee }}"
                  />
                </div>

                <div>
                  <label for="editStudentFacultyName">Faculty Name</label>
                  <select name="faculty_name" id="editStudentFacultyName" required class="input-field">
                    <option value="">Select Faculty</option>
                    {% for i in faculty %}
                      <option value="{{ i.username }}" {% if student.faculty_name == i.username %}selected{% endif %}>{{ i.username }}</option>
                    {% endfor %}
                  </select>
                </div>

                <div>
                  <label for="editStudentPincode">Pincode</label>
                  <input
                    type="number"
                    name="pincode"
                    id="editStudentPincode"
                    placeholder="Enter pincode"
                    required
                    class="input-field"
                    value="{{ student.pincode }}"
                  />
                </div>

                <div>
                  <label for="editStudentQualification">Qualification</label>
                  <input
                    type="text"
                    name="qualification"
                    id="editStudentQualification"
                    placeholder="Enter qualification"
                    required
                    class="input-field"
                    value="{{ student.qualification }}"
                  />
                </div>

                <div>
                  <label for="editStudentMaritalStatus">Marital Status</label>
                  <select name="marital_status" id="editStudentMaritalStatus" required class="input-field">
                    <option value="">Select Marital Status</option>
                    <option value="Single" {% if student.marital_status == "Single" %}selected{% endif %}>Single</option>
                    <option value="Married" {% if student.marital_status == "Married" %}selected{% endif %}>Married</option>
                  </select>
                </div>

                <div class="md:col-span-2">
                  <label for="editStudentAddress">Address</label>
                  <textarea
                    name="address"
                    id="editStudentAddress"
                    placeholder="Enter complete address"
                    required
                    rows="3"
                    class="input-field"
                  >{{ student.address }}</textarea>
                </div>

                <div class="flex items-center space-x-3">
                  <input
                    type="checkbox"
                    name="online"
                    id="editStudentOnline"
                    class="w-5 h-5 text-pink-600 border-2 border-gray-300 rounded focus:ring-pink-500"
                    {% if student.online %}checked{% endif %}
                  />
                  <label for="editStudentOnline" class="text-sm font-medium text-gray-700">Online Course</label>
                </div>
              </div>

              <div class="flex justify-end space-x-4 pt-6 border-t border-gray-200">
                <button
                  type="button"
                  data-modal-hide="editStudentModal"
                  class="px-6 py-3 text-gray-700 bg-gray-200 hover:bg-gray-300 rounded-xl font-medium transition-colors"
                >
                  Cancel
                </button>
                <button
                  type="submit"
                  class="px-8 py-3 bg-gradient-button text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transition-all duration-300"
                >
                  Update Student
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Receipt Modal-->
    <div id="generateReceiptModal" tabindex="-1" aria-hidden="true" class="fixed top-0 left-0 right-0 z-50 hidden w-full p-4 overflow-x-hidden overflow-y-auto h-[calc(100%-1rem)] max-h-full modal-backdrop">
      <div class="relative p-4 w-full max-w-4xl">
        <div class="relative bg-white rounded-2xl shadow-2xl">
          <!-- Header -->
          <div class="flex justify-between items-center p-6 border-b border-gray-200 rounded-t-2xl">
            <h3 class="text-2xl font-bold gradient-text">Generate Receipt</h3>
            <button
              data-modal-hide="generateReceiptModal"
              class="text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full p-2 transition-colors"
            >
              <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
              </svg>
            </button>
          </div>

          <!-- Body -->
          <div class="p-6 max-h-[70vh] overflow-y-auto">
            <form method="post" action="{% url 'app:add_receipt' %}" id="receiptForm" class="space-y-6">
              {% csrf_token %}
              <input type="hidden" name="student_id" value="{{ student.id }}">
                <input type="hidden" name="redirect" value="ss">
              <div class="flex flex-col gap-6">
                <div>
                  <label for="receiptStudentName">Student Name</label>
                  <input
                    type="text"
                    name="name"
                    id="receiptStudentName"
                    placeholder="Enter full name"
                    required
                    class="input-field"
                    value="{{ student.name }}"
                  />
                </div>

                <div>
                  <label for="receiptCourseName">Course Name </label>
                  <select name="course_name" id="receiptCourseName" required class="input-field">
                    <option value="">Select Course</option>
                    {% for course in courses %}
                    <option value="{{course.course_name}}" {% if student.course_name == course.course_name %}selected{% endif %}>{{course.course_name}}</option>
                    {% endfor %}
                  </select>
                </div>

                <div>
                  <label>Total fee = {{ student.total_fee }} {%if payment %} <span class="text-red-500">Amount Paid = {{ payment.paid_ammount }}</span>{% else %}  <span class="text-red-500">Amount Paid =   {{0 }}</span>{% endif %}</label>
                  <label for="receiptAmount">Amount</label>
                  <input
                    type="number"
                    name="amount"
                    id="receiptAmount"
                    placeholder="eg {{ student.total_fee }}"
                    required
                    class="input-field"
                    value="{{ student.amount }}"
                  />
                </div>
                <div>
                  <label for="receiptDate">Date</label>
                  <input
                    type="date"
                    name="date"
                    id="receiptDate"
                    placeholder="Date "
                    required
                    class="input-field"
                    value=""
                  />
                </div>
              </div>

              <div class="flex justify-end space-x-4 pt-6 border-t border-gray-200">
                <button
                  type="button"
                  data-modal-hide="generateReceiptModal"
                  class="px-6 py-3 text-gray-700 bg-gray-200 hover:bg-gray-300 rounded-xl font-medium transition-colors"
                >
                  Cancel
                </button>
                 <button
                  id="recipt_btn"
                  onclick="reciptBlock()"
                  type="submit"
                  class="px-8 py-3 bg-gradient-button text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transition-all duration-300"
                >
                  Create Receipt
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Include Flowbite JS -->
    <script src="{% static 'js/flowbite.min.js' %}"></script>
    <script src="{% static 'js/flatpickr.js' %}"></script>

    <script>
       function GCBlock(){
        const recipt_button = document.getElementById("GC_btn");
        recipt_button.disabled = true;
        document.getElementById("GCForm").submit()
      }
      function reciptBlock(){
        const recipt_button = document.getElementById("recipt_btn");
        recipt_button.disabled = true;
        document.getElementById("receiptForm").submit()
      }
      document.addEventListener('DOMContentLoaded', function () {
        const certificateType = document.getElementById('certificate_type');
        const projectTitleWrapper = document.getElementById('project_title_wrapper');
        const dateWrapper = document.getElementById("date_wrapper");
        // Show/hide based on certificate type
        certificateType.addEventListener('change', function () {
          if (this.value === 'a4') {
            projectTitleWrapper.classList.remove('hidden');
            dateWrapper.classList.remove('hidden');
          } else {
            projectTitleWrapper.classList.add('hidden');
            dateWrapper.classList.add('hidden');
          }
        });


        // Initialize flatpickr for date range
        flatpickr("#dateRange", {
          mode: "range",
          dateFormat: "Y-m-d",
          defaultDate: [new Date(), new Date()],
          maxDate: "today"
        });

        // Auto-dismiss messages after 5 seconds
        setTimeout(() => {
          document.querySelectorAll('.message').forEach(el => {
            el.style.opacity = '0';
            setTimeout(() => el.remove(), 300);
          });
        }, 5000);
      });
    </script>
  </body>
</html>